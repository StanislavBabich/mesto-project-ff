(()=>{"use strict";var e="",t="57f7533b-cf35-4402-a07a-8edc3d037c3d",n="https://mesto.nomoreparties.co/v1/".concat("wff-cohort-42");function r(e){return e.ok?e.json():e.json().catch((function(){return{}})).then((function(t){return Promise.reject({status:e.status,body:t})}))}var o=document.querySelector("#card-template");function a(e,t){t.textContent=e.length}function c(e,o,c){var i;o.classList.contains("card__like-button_is-active")?(i=e._id,fetch("".concat(n,"/cards/likes/").concat(i),{method:"DELETE",headers:{authorization:t}}).then(r)).then((function(t){o.classList.remove("card__like-button_is-active"),a(t.likes,c),e.likes=t.likes})).catch((function(e){return console.error("Ошибка снятия лайка:",e)})):function(e){return fetch("".concat(n,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:t}}).then(r)}(e._id).then((function(t){o.classList.add("card__like-button_is-active"),a(t.likes,c),e.likes=t.likes})).catch((function(e){return console.error("Ошибка постановки лайка:",e)}))}function i(e,t,n,r){var a=o.content.querySelector(".card").cloneNode(!0),c=a.querySelector(".card__image"),i=a.querySelector(".card__delete-button"),u=a.querySelector(".card__title"),l=a.querySelector(".card__like-button"),s=a.querySelector(".card__like-count");c.src=e.link,c.alt=e.name,u.textContent=e.name,s.textContent=e.likes?e.likes.length:0;var d=window.currentUserId||null;return e.owner&&e.owner._id===d||(i.style.display="none"),e.likes&&e.likes.some((function(e){return e._id===d}))&&l.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(n){n.preventDefault(),"function"==typeof t&&t(e._id,a)})),l.addEventListener("click",(function(){n(e,l,s)})),c.addEventListener("click",(function(){"function"==typeof r&&r(e.link,e.name)})),a}function u(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),10),e._handleEsc=function(t){"Escape"===t.key&&l(e)},document.addEventListener("keydown",e._handleEsc)}function l(e){e.classList.remove("popup_is-opened"),e.addEventListener("transitionend",(function t(n){"opacity"!==n.propertyName&&"visibility"!==n.propertyName||(e.removeEventListener("transitionend",t),e.classList.remove("popup_is-animated"),e._handleEsc&&(document.removeEventListener("keydown",e._handleEsc),delete e._handleEsc))}))}function s(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));r&&(t.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass))}function d(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=t.value.trim(),a="true"===t.dataset.touched||r;if(t.setCustomValidity(""),t.validity.tooShort){var c=t.getAttribute("minlength"),i=o.length;t.setCustomValidity("Минимальное количество символов: ".concat(c,". Длина текста сейчас: ").concat(i," символ."))}else"avatar-link"===t.name||"link"===t.name?""===o?t.setCustomValidity("Вы пропустили это поле."):t.validity.typeMismatch&&t.setCustomValidity("Введите адрес сайта."):t.hasAttribute("data-error")?(["name","description"].includes(t.name)&&(""===o||/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(o)||t.setCustomValidity(t.dataset.error||"Некорректный формат")),t.hasAttribute("required")&&""===o&&t.setCustomValidity("Вы пропустили это поле.")):t.hasAttribute("required")&&""===o&&t.setCustomValidity("Вы пропустили это поле.");return t.validity.valid?(s(e,t,n),!0):(a?function(e,t,n,r){var o=e.querySelector("#".concat(t.id,"-error"));o&&(t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass))}(e,t,t.validationMessage,n):s(e,t,n),!1)}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.some((function(e){return!d(e.closest(t.formSelector),e,t,n)}))}function f(e,t,n){p(e,n,arguments.length>3&&void 0!==arguments[3]&&arguments[3])?(t.classList.add(n.inactiveButtonClass),t.disabled=!0):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1)}function m(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.dataset.touched="false",s(e,n,t)})),f(n,r,t)}const y=e+"0863e5bc26221680f1e2.svg",v=e+"6666407ac3aa5af1d5de.jpg";function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};document.querySelector(".header__logo").src=y;var S=document.querySelector(".profile__image");S.style.backgroundImage="url(".concat(v,")");var b=document.querySelector(".profile__avatar-edit-button");b&&b.remove();var q,E=document.querySelector(".places__list"),k=document.querySelector(".popup_type_image"),C=k.querySelector(".popup__image"),L=k.querySelector(".popup__caption"),g=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),x=document.querySelector(".popup_type_edit"),w=x.querySelector(".popup__form"),j=w.querySelector("#popup__profile-name"),T=w.querySelector("#popup__profile-job"),I=document.querySelector(".popup_type_new-card"),z=I.querySelector(".popup__form"),D=z.querySelector("#popup__card-name"),B=z.querySelector("#popup__card-url"),V=document.querySelector(".popup_type_edit-avatar"),O=V.querySelector(".popup__form"),N=O.querySelector("#popup__avatar-url"),P=document.querySelector(".popup_type_confirm-delete"),U=P.querySelector(".popup__form"),M=U.querySelector(".popup__button"),H=document.querySelector(".profile__edit-button"),J=document.querySelector(".profile__add-button"),$=document.getElementById("profileAvatar"),Z=null,F=null;function G(e,t){C.src=e,C.alt=t,L.textContent=t,u(k)}function K(){O.reset(),m(O,h),u(V)}function Q(e,t){Z=e,F=t,M.textContent="Да",M.disabled=!1,u(P)}function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";t?(e.textContent=n,e.disabled=!0):(e.textContent=r,e.disabled=!1)}U.addEventListener("submit",(function(e){var o;e.preventDefault(),Z&&F?(M.textContent="Удаление...",M.disabled=!0,(o=Z,fetch("".concat(n,"/cards/").concat(o),{method:"DELETE",headers:{authorization:t}}).then(r)).then((function(){F.remove(),l(P)})).catch((function(e){return console.error("Ошибка удаления карточки: ".concat(e))})).finally((function(){M.textContent="Да",M.disabled=!1,Z=null,F=null}))):l(P)})),H.addEventListener("click",(function(){j.value=g.textContent,T.value=A.textContent,m(w,h),u(x)})),J.addEventListener("click",(function(){z.reset(),m(z,h),u(I)})),$.addEventListener("click",K),$.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),K())})),w.addEventListener("submit",(function(e){e.preventDefault();var o,a,c,i=e.submitter||w.querySelector('button[type="submit"]'),u=i.textContent;R(i,!0),(o={name:j.value.trim(),about:T.value.trim()},a=o.name,c=o.about,fetch("".concat(n,"/users/me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:a,about:c})}).then(r)).then((function(e){g.textContent=e.name,A.textContent=e.about,l(x)})).catch((function(e){return console.error("Ошибка обновления профиля: ".concat(e))})).finally((function(){R(i,!1,"",u),f(Array.from(w.querySelectorAll(h.inputSelector)),i,h)}))})),z.addEventListener("submit",(function(e){e.preventDefault();var o=e.submitter||z.querySelector('button[type="submit"]'),a=o.textContent,u=D.value.trim(),s=B.value.trim();R(o,!0),function(e){var o=e.name,a=e.link;return fetch("".concat(n,"/cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:a})}).then(r)}({name:u,link:s}).then((function(e){var t=i(e,Q,c,G);E.prepend(t),z.reset(),m(z,h),l(I)})).catch((function(e){return console.error("Ошибка добавления карточки: ".concat(e))})).finally((function(){R(o,!1,"",a),f(Array.from(z.querySelectorAll(h.inputSelector)),o,h)}))})),O.addEventListener("submit",(function(e){e.preventDefault();var o,a=e.submitter||O.querySelector('button[type="submit"]'),c=a.textContent,i=N.value.trim();R(a,!0),(o=i,fetch("".concat(n,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:o})}).then(r)).then((function(e){S.style.backgroundImage="url(".concat(e.avatar,")"),l(V),O.reset(),m(O,h)})).catch((function(e){return console.error("Ошибка обновления аватара: ".concat(e))})).finally((function(){R(a,!1,"",c),f(Array.from(O.querySelectorAll(h.inputSelector)),a,h)}))})),document.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return l(e)})),e.addEventListener("click",(function(t){t.target===e&&l(e)}))})),window.currentUserId=null,Promise.all([fetch("".concat(n,"/users/me"),{headers:{authorization:t}}).then(r),fetch("".concat(n,"/cards"),{headers:{authorization:t}}).then(r)]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];window.currentUserId=o._id,g.textContent=o.name,A.textContent=o.about,S.style.backgroundImage="url(".concat(o.avatar,")"),E.innerHTML="",a.forEach((function(e){var t=i(e,Q,c,G);E.appendChild(t)}))})).catch((function(e){return console.error("Ошибка загрузки данных: ".concat(e))})),q=h,Array.from(document.querySelectorAll(q.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault();var n=Array.from(e.querySelectorAll(q.inputSelector)),r=e.querySelector(q.submitButtonSelector);n.forEach((function(t){t.dataset.touched="true",d(e,t,q,!0)})),f(n,r,q,!0),p(n,q,!0)||e.dispatchEvent(new Event("formValid"))})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);f(n,r,t),n.forEach((function(o){o.dataset.touched="false",o.addEventListener("input",(function(){o.dataset.touched="true",d(e,o,t),f(n,r,t)})),o.addEventListener("blur",(function(){o.dataset.touched="true",d(e,o,t),f(n,r,t)}))}))}(e,q)}))})();