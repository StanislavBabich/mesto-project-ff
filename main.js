(()=>{"use strict";var e="",t="57f7533b-cf35-4402-a07a-8edc3d037c3d",n="https://mesto.nomoreparties.co/v1/".concat("wff-cohort-42");function r(e){return e.ok?e.json():e.json().then((function(t){return Promise.reject({status:e.status,body:t})})).catch((function(){return Promise.reject({status:e.status,body:{}})}))}function o(e,t){t.textContent=e.length}function a(e,a,i){var c;a.classList.contains("card__like-button_is-active")?(c=e._id,fetch("".concat(n,"/cards/likes/").concat(c),{method:"DELETE",headers:{authorization:t}}).then(r)).then((function(t){a.classList.remove("card__like-button_is-active"),o(t.likes,i),e.likes=t.likes})).catch((function(e){return console.error("Ошибка снятия лайка:",e)})):function(e){return fetch("".concat(n,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:t}}).then(r)}(e._id).then((function(t){a.classList.add("card__like-button_is-active"),o(t.likes,i),e.likes=t.likes})).catch((function(e){return console.error("Ошибка постановки лайка:",e)}))}function i(e,t,n,r){var o=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=o.querySelector(".card__image"),i=o.querySelector(".card__delete-button"),c=o.querySelector(".card__title"),u=o.querySelector(".card__like-button"),l=o.querySelector(".card__like-count");a.src=e.link,a.alt=e.name,c.textContent=e.name,l.textContent=e.likes?e.likes.length:0;var s=window.currentUserId||null;return e.owner&&e.owner._id===s||(i.style.display="none"),e.likes&&e.likes.some((function(e){return e._id===s}))&&u.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(n){n.preventDefault(),"function"==typeof t&&t(e._id,o)})),u.addEventListener("click",(function(){n(e,u,l)})),a.addEventListener("click",(function(){"function"==typeof r&&r(e.link,e.name)})),o}function c(e){e.classList.add("popup_is-animated"),e.classList.remove("popup_is-opened"),requestAnimationFrame((function(){e.classList.add("popup_is-opened")})),e._handleEsc=function(t){"Escape"===t.key&&u(e)},document.addEventListener("keydown",e._handleEsc)}function u(e){e.classList.remove("popup_is-opened"),e.addEventListener("transitionend",(function t(n){"opacity"!==n.propertyName&&"visibility"!==n.propertyName||(e.removeEventListener("transitionend",t),e.classList.remove("popup_is-animated"),e._handleEsc&&(document.removeEventListener("keydown",e._handleEsc),delete e._handleEsc))}))}var l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function s(e,t,n,r){var o=e.querySelector("#".concat(t.id,"-error"));o&&(t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass))}function d(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));r&&(t.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass))}function p(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=t.value.trim(),a="true"===t.dataset.touched||r;if(t.hasAttribute("data-error")&&("popup__profile-name"===t.id||"popup__profile-job"===t.id||"popup__card-name"===t.id)){if(""===o)return a?s(e,t,"Вы пропустили это поле",n):d(e,t,n),!1;if(!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(o))return a?s(e,t,t.dataset.error,n):d(e,t,n),!1;if(t.hasAttribute("minlength")){var i=Number(t.getAttribute("minlength"));if(o.length<i)return a?s(e,t,"Минимальное количество символов: ".concat(i,". Длина текста сейчас: ").concat(o.length," символ."),n):d(e,t,n),!1}if(t.hasAttribute("maxlength")){var c=Number(t.getAttribute("maxlength"));if(o.length>c)return a?s(e,t,"Максимальное количество символов: ".concat(c,". Длина текста сейчас: ").concat(o.length," символ."),n):d(e,t,n),!1}return d(e,t,n),!0}return"popup__card-url"===t.id||"popup__avatar-url"===t.id?""===o?(a?s(e,t,"Вы пропустили это поле",n):d(e,t,n),!1):t.validity.valid?(d(e,t,n),!0):(a?s(e,t,t.dataset.error||t.validationMessage,n):d(e,t,n),!1):t.validity.valid?(d(e,t,n),!0):(a?s(e,t,t.validationMessage,n):d(e,t,n),!1)}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.some((function(e){return!p(e.closest(t.formSelector),e,t,n)}))}function m(e,t,n){f(e,n,arguments.length>3&&void 0!==arguments[3]&&arguments[3])?(t.classList.add(n.inactiveButtonClass),t.disabled=!0):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1)}function y(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.dataset.touched="false",d(e,n,t)})),r.disabled=!0,r.classList.add(t.inactiveButtonClass)}const _=e+"0863e5bc26221680f1e2.svg",v=e+"6666407ac3aa5af1d5de.jpg";function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}document.querySelector(".header__logo").src=_;var S=document.querySelector(".profile__image");S.style.backgroundImage="url(".concat(v,")");var b=document.querySelector(".profile__avatar-edit-button");b&&b.remove();var q,E=document.querySelector(".places__list"),g=document.querySelector(".popup_type_image"),k=g.querySelector(".popup__image"),C=g.querySelector(".popup__caption"),L=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),x=document.querySelector(".popup_type_edit"),w=x.querySelector(".popup__form"),j=w.querySelector("#popup__profile-name"),B=w.querySelector("#popup__profile-job"),T=document.querySelector(".popup_type_new-card"),I=T.querySelector(".popup__form"),z=I.querySelector("#popup__card-name"),D=I.querySelector("#popup__card-url"),N=document.querySelector(".popup_type_edit-avatar"),O=N.querySelector(".popup__form"),P=O.querySelector("#popup__avatar-url"),U=document.querySelector(".popup_type_confirm-delete"),M=U.querySelector(".popup__form"),H=M.querySelector(".popup__button"),J=document.querySelector(".profile__edit-button"),$=document.querySelector(".profile__add-button"),F=document.getElementById("profileAvatar"),V=null,Z=null;function G(e,t){k.src=e,k.alt=t,C.textContent=t,c(g)}function K(){O.reset(),y(O,l),m(Array.from(O.querySelectorAll(l.inputSelector)),O.querySelector(l.submitButtonSelector),l,!1),c(N)}function Q(e,t){V=e,Z=t,H.textContent="Да",H.disabled=!1,c(U)}M.addEventListener("submit",(function(e){var o;e.preventDefault(),V&&Z?(H.textContent="Удаление...",H.disabled=!0,(o=V,fetch("".concat(n,"/cards/").concat(o),{method:"DELETE",headers:{authorization:t}}).then(r)).then((function(){Z.remove(),u(U)})).finally((function(){H.textContent="Да",H.disabled=!1,V=null,Z=null}))):u(U)})),J.addEventListener("click",(function(){j.value=L.textContent,B.value=A.textContent,y(w,l),m(Array.from(w.querySelectorAll(l.inputSelector)),w.querySelector(l.submitButtonSelector),l,!1),c(x)})),$.addEventListener("click",(function(){I.reset(),y(I,l),c(T)})),F.addEventListener("click",K),F.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),K())})),w.addEventListener("submit",(function(e){e.preventDefault();var o,a,i,c=w.querySelector(l.submitButtonSelector),s=c.textContent;c.textContent="Сохранение...",c.disabled=!0,(o={name:j.value.trim(),about:B.value.trim()},a=o.name,i=o.about,fetch("".concat(n,"/users/me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:a,about:i})}).then(r)).then((function(e){L.textContent=e.name,A.textContent=e.about,u(x)})).finally((function(){c.textContent=s,m(Array.from(w.querySelectorAll(l.inputSelector)),c,l)}))})),I.addEventListener("submit",(function(e){e.preventDefault();var o=z.value.trim(),c=D.value.trim(),s=I.querySelector(l.submitButtonSelector),d=s.textContent;s.textContent="Сохранение...",s.disabled=!0,function(e){var o=e.name,a=e.link;return fetch("".concat(n,"/cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:a})}).then(r)}({name:o,link:c}).then((function(e){var t=i(e,Q,a,G);E.prepend(t),I.reset(),y(I,l),u(T)})).finally((function(){s.textContent=d,m(Array.from(I.querySelectorAll(l.inputSelector)),s,l)}))})),O.addEventListener("submit",(function(e){e.preventDefault();var o,a=P.value.trim(),i=O.querySelector(l.submitButtonSelector),c=i.textContent;i.textContent="Сохранение...",i.disabled=!0,(o=a,fetch("".concat(n,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:o})}).then(r)).then((function(e){S.style.backgroundImage="url(".concat(e.avatar,")"),u(N),O.reset(),y(O,l)})).finally((function(){i.textContent=c,m(Array.from(O.querySelectorAll(l.inputSelector)),i,l)}))})),document.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return u(e)})),e.addEventListener("click",(function(t){t.target===e&&u(e)}))})),window.currentUserId=null,Promise.all([fetch("".concat(n,"/users/me"),{headers:{authorization:t}}).then(r),fetch("".concat(n,"/cards"),{headers:{authorization:t}}).then(r)]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];window.currentUserId=o._id,L.textContent=o.name,A.textContent=o.about,S.style.backgroundImage="url(".concat(o.avatar,")"),E.innerHTML="",c.forEach((function(e){var t=i(e,Q,a,G);E.appendChild(t)}))})),q=l,Array.from(document.querySelectorAll(q.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault();var n=Array.from(e.querySelectorAll(q.inputSelector)),r=e.querySelector(q.submitButtonSelector);n.forEach((function(t){t.dataset.touched="true",p(e,t,q,!0)})),m(n,r,q,!0),f(n,q,!0)||e.dispatchEvent(new Event("formValid"))})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);m(n,r,t),n.forEach((function(o){o.dataset.touched="false",o.addEventListener("input",(function(){o.dataset.touched="true",p(e,o,t),m(n,r,t)})),o.addEventListener("blur",(function(){o.dataset.touched="true",p(e,o,t),m(n,r,t)}))}))}(e,q)}))})();