(()=>{"use strict";var e="",t="57f7533b-cf35-4402-a07a-8edc3d037c3d",r="https://mesto.nomoreparties.co/v1/".concat("wff-cohort-42");function n(e){return e.ok?e.json():e.json().then((function(t){return Promise.reject({status:e.status,body:t})})).catch((function(){return Promise.reject({status:e.status,body:{}})}))}function o(e,t){t.textContent=e.length}function a(e,a,c){var i;a.classList.contains("card__like-button_is-active")?(i=e._id,fetch("".concat(r,"/cards/likes/").concat(i),{method:"DELETE",headers:{authorization:t}}).then(n)).then((function(t){a.classList.remove("card__like-button_is-active"),o(t.likes,c),e.likes=t.likes})).catch((function(e){return console.error("Ошибка снятия лайка:",e)})):function(e){return fetch("".concat(r,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:t}}).then(n)}(e._id).then((function(t){a.classList.add("card__like-button_is-active"),o(t.likes,c),e.likes=t.likes})).catch((function(e){return console.error("Ошибка постановки лайка:",e)}))}function c(e,t,r,n){var o=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=o.querySelector(".card__image"),c=o.querySelector(".card__delete-button"),i=o.querySelector(".card__title"),u=o.querySelector(".card__like-button"),l=o.querySelector(".card__like-count");a.src=e.link,a.alt=e.name,i.textContent=e.name,l.textContent=e.likes?e.likes.length:0;var s=window.currentUserId||null;return e.owner&&e.owner._id===s||(c.style.display="none"),e.likes&&e.likes.some((function(e){return e._id===s}))&&u.classList.add("card__like-button_is-active"),c.addEventListener("click",(function(r){r.preventDefault(),"function"==typeof t&&t(e._id,o)})),u.addEventListener("click",(function(){r(e,u,l)})),a.addEventListener("click",(function(){"function"==typeof n&&n(e.link,e.name)})),o}function i(e){e.classList.add("popup_is-animated"),e.classList.remove("popup_is-opened"),requestAnimationFrame((function(){e.classList.add("popup_is-opened")})),e._handleEsc=function(t){"Escape"===t.key&&u(e)},document.addEventListener("keydown",e._handleEsc)}function u(e){e.classList.remove("popup_is-opened"),e.addEventListener("transitionend",(function t(r){"opacity"!==r.propertyName&&"visibility"!==r.propertyName||(e.removeEventListener("transitionend",t),e.classList.remove("popup_is-animated"),e._handleEsc&&(document.removeEventListener("keydown",e._handleEsc),delete e._handleEsc))}))}var l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function s(e,t,r,n){var o=e.querySelector("#".concat(t.id,"-error"));o&&(t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass))}function d(e,t,r){var n=e.querySelector("#".concat(t.id,"-error"));n&&(t.classList.remove(r.inputErrorClass),n.textContent="",n.classList.remove(r.errorClass))}function p(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=t.value.trim(),a="true"===t.dataset.touched||n;if(t.hasAttribute("data-error")&&("popup__profile-name"===t.id||"popup__profile-job"===t.id||"popup__card-name"===t.id)){if(""===o)return a?s(e,t,"Вы пропустили это поле",r):d(e,t,r),!1;if(!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(o))return a?s(e,t,t.dataset.error,r):d(e,t,r),!1;if(t.hasAttribute("minlength")){var c=Number(t.getAttribute("minlength"));if(o.length<c)return a?s(e,t,"Минимальное количество символов: ".concat(c,". Длина текста сейчас: ").concat(o.length," символ."),r):d(e,t,r),!1}if(t.hasAttribute("maxlength")){var i=Number(t.getAttribute("maxlength"));if(o.length>i)return a?s(e,t,"Максимальное количество символов: ".concat(i,". Длина текста сейчас: ").concat(o.length," символ."),r):d(e,t,r),!1}return d(e,t,r),!0}return"popup__card-url"===t.id||"popup__avatar-url"===t.id?""===o?(a?s(e,t,"Вы пропустили это поле",r):d(e,t,r),!1):t.validity.valid?(d(e,t,r),!0):(a?s(e,t,t.dataset.error||t.validationMessage,r):d(e,t,r),!1):t.validity.valid?(d(e,t,r),!0):(a?s(e,t,t.validationMessage,r):d(e,t,r),!1)}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.some((function(e){return!p(e.closest(t.formSelector),e,t,r)}))}function m(e,t,r){f(e,r,arguments.length>3&&void 0!==arguments[3]&&arguments[3])?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)}function y(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);r.forEach((function(r){r.dataset.touched="false",d(e,r,t)})),n.disabled=!0,n.classList.add(t.inactiveButtonClass)}const v=e+"0863e5bc26221680f1e2.svg",_=e+"6666407ac3aa5af1d5de.jpg";function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}document.querySelector(".header__logo").src=v;var S=document.querySelector(".profile__image");S.style.backgroundImage="url(".concat(_,")");var b=document.querySelector(".profile__avatar-edit-button");b&&b.remove();var q,E=document.querySelector(".places__list"),g=document.querySelector(".popup_type_image"),L=g.querySelector(".popup__image"),k=g.querySelector(".popup__caption"),C=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),x=document.querySelector(".popup_type_edit"),w=x.querySelector(".popup__form"),j=w.querySelector("#popup__profile-name"),B=w.querySelector("#popup__profile-job"),T=document.querySelector(".popup_type_new-card"),z=T.querySelector(".popup__form"),I=z.querySelector("#popup__card-name"),D=z.querySelector("#popup__card-url"),N=document.querySelector(".popup_type_edit-avatar"),U=N.querySelector(".popup__form"),O=U.querySelector("#popup__avatar-url"),P=document.querySelector(".popup_type_confirm-delete"),M=P.querySelector(".popup__form"),H=M.querySelector(".popup__button"),J=document.querySelector(".profile__edit-button"),R=document.querySelector(".profile__add-button"),$=document.getElementById("profileAvatar"),Z=null,F=null;function V(e,t){L.src=e,L.alt=t,k.textContent=t,i(g)}function G(){U.reset(),y(U,l),m(Array.from(U.querySelectorAll(l.inputSelector)),U.querySelector(l.submitButtonSelector),l,!1),i(N)}function K(e,t){Z=e,F=t,H.textContent="Да",H.disabled=!1,i(P)}function Q(e){try{var t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}}M.addEventListener("submit",(function(e){var o;e.preventDefault(),Z&&F?(H.textContent="Удаление...",H.disabled=!0,(o=Z,fetch("".concat(r,"/cards/").concat(o),{method:"DELETE",headers:{authorization:t}}).then(n)).then((function(){F.remove(),u(P)})).catch((function(e){console.error("Ошибка удаления карточки:",e),alert("Не удалось удалить карточку")})).finally((function(){H.textContent="Да",H.disabled=!1,Z=null,F=null}))):u(P)})),J.addEventListener("click",(function(){j.value=C.textContent,B.value=A.textContent,y(w,l),m(Array.from(w.querySelectorAll(l.inputSelector)),w.querySelector(l.submitButtonSelector),l,!1),i(x)})),R.addEventListener("click",(function(){z.reset(),y(z,l),i(T)})),$.addEventListener("click",G),$.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),G())})),w.addEventListener("submit",(function(e){e.preventDefault();var o=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/,a=""!==j.value.trim()&&o.test(j.value.trim()),c=""!==B.value.trim()&&o.test(B.value.trim());if(a&&c){var i,s,d,p=w.querySelector(l.submitButtonSelector),f=p.textContent;p.textContent="Сохранение...",p.disabled=!0,(i={name:j.value.trim(),about:B.value.trim()},s=i.name,d=i.about,fetch("".concat(r,"/users/me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:s,about:d})}).then(n)).then((function(e){C.textContent=e.name,A.textContent=e.about,u(x)})).catch((function(e){console.error("Ошибка обновления профиля:",e),alert("Не удалось обновить профиль")})).finally((function(){p.textContent=f,m(Array.from(w.querySelectorAll(l.inputSelector)),p,l)}))}else alert("Имя и описание должны содержать только буквы, пробелы и тире")})),z.addEventListener("submit",(function(e){e.preventDefault();var o=I.value.trim(),i=D.value.trim();if(o)if(Q(i)){var s=z.querySelector(l.submitButtonSelector),d=s.textContent;s.textContent="Сохранение...",s.disabled=!0,function(e){var o=e.name,a=e.link;return fetch("".concat(r,"/cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:a})}).then(n)}({name:o,link:i}).then((function(e){var t=c(e,K,a,V);E.prepend(t),z.reset(),y(z,l),u(T)})).catch((function(e){console.error("Ошибка добавления карточки:",e);var t="Не удалось добавить карточку";e&&e.status&&(t+=" (код ошибки ".concat(e.status,")"),e.body&&e.body.message&&(t+=": ".concat(e.body.message))),alert(t)})).finally((function(){s.textContent=d,m(Array.from(z.querySelectorAll(l.inputSelector)),s,l)}))}else alert("Введите корректный URL изображения, начинающийся с http:// или https://");else alert("Введите название карточки")})),U.addEventListener("submit",(function(e){e.preventDefault();var o=O.value.trim();if(Q(o)){var a,c=U.querySelector(l.submitButtonSelector),i=c.textContent;c.textContent="Сохранение...",c.disabled=!0,(a=o,fetch("".concat(r,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:a})}).then(n)).then((function(e){S.style.backgroundImage="url(".concat(e.avatar,")"),u(N),U.reset(),y(U,l)})).catch((function(e){console.error("Ошибка обновления аватара:",e),alert("Не удалось обновить аватар")})).finally((function(){c.textContent=i,m(Array.from(U.querySelectorAll(l.inputSelector)),c,l)}))}else alert("Введите корректный URL, начинающийся с http:// или https://")})),document.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return u(e)})),e.addEventListener("click",(function(t){t.target===e&&u(e)}))})),window.currentUserId=null,Promise.all([fetch("".concat(r,"/users/me"),{headers:{authorization:t}}).then(n),fetch("".concat(r,"/cards"),{headers:{authorization:t}}).then(n)]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,c,i=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(t,r)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],i=n[1];console.log("Данные профиля:",o),window.currentUserId=o._id,C.textContent=o.name,A.textContent=o.about,S.style.backgroundImage="url(".concat(o.avatar,")"),E.innerHTML="",i.forEach((function(e){var t=c(e,K,a,V);E.appendChild(t)}))})).catch((function(e){console.error("Ошибка загрузки данных с сервера:",e),alert("Не удалось загрузить данные с сервера")})),q=l,Array.from(document.querySelectorAll(q.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault();var r=Array.from(e.querySelectorAll(q.inputSelector)),n=e.querySelector(q.submitButtonSelector);r.forEach((function(t){t.dataset.touched="true",p(e,t,q,!0)})),m(r,n,q,!0),f(r,q,!0)||e.dispatchEvent(new Event("formValid"))})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);m(r,n,t),r.forEach((function(o){o.dataset.touched="false",o.addEventListener("input",(function(){o.dataset.touched="true",p(e,o,t),m(r,n,t)})),o.addEventListener("blur",(function(){o.dataset.touched="true",p(e,o,t),m(r,n,t)}))}))}(e,q)}))})();